<!DOCTYPE html>
<html>

<head>
    <title data-msgid="ChiSquare Distribution">Chi-sqare Distribution</title>
    <link rel="stylesheet" href="/estat/eStat/css/eStatU.css">
    <script src="/estat/eStat/lib/d3/d3.v4.min.js"></script>
    <script src="/estat/eStat/lib/jquery/jquery-3.2.1.min.js"></script>
    <script src="/estat/eStat/lib/jquery/jquery-ui.min.js"></script>
    <script src="/estat/eStat/lib/DistributionsUtil.js" ></script>
    <script src="/estat/eStat/js/language.js" ></script>
    <script src="/estat/eStat/js/eStatU.js"></script>
    <script src="/estat/eStat/lib/FileSaver.min.js" ></script>
    <script src="/estat/eStat/lib/convertSVG.js"></script>
</head>

<body>
  <div width="600" height="410" style="position:absolute; left:10px; top:0px">
    <br>
    <div class="title">
      <b>&nbsp; <span data-msgid="ChiSquare Distribution">ChiSquae Distribution</span></b> 
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  
      df =  <input type="text" class="textarea" value="10" size=4 id="dfchi" onfocus="focus0()" onKeyUp="changeRangeCdf()"> 
      <sup><small>1 </small></sup>
      <input type="range" min="1" max="100" value="10" id="range1C" onchange="showValueChisq0(this.value)"/>
      <sup><small>100 </small></sup> 
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      <a class="menu" href="../Distribution/index.html"><b><span data-msgid="Menu">Menu</span></b></a>  
    </div>
    <p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
    <span style="color:red;" data-msgid="If typed"></span> 
    <p>
    <svg id="chart" width="600" height="400"> </svg> 

    <section class="range-slider">
    <input type="range" min="0" max="300" value="33"  id="range21Chi" onchange="showValueChisq1(this.value)"/>
    <input type="range" min="0" max="300" value="205" id="range22Chi" onchange="showValueChisq2(this.value)"/>
    </section>

    <form name="myForm"> 
      <table class="stat">
      <tbody>
        <tr>
          <td>
            <button type="button" id="Execute">
              <span data-msgid="Execute">Execute</span>
            </button>
          </td>
        </tr>
        <tr>
          <td><span data-msgid="Probability"></span></td>
          <td>
            <label> 
              <input type="radio" name = "type1" value="1" checked> 
              P( <input type="text" class="textarea" value="3.247" size=6  id="a" onfocus="focus1()" onKeyUp="executeClick()"/> 
              &nbsp; &le; &nbsp; &chi;<sup>2</sup> &nbsp; &le; &nbsp; 
              <input type="text" class="textarea"  value="20.483"  size=6 id="b" onfocus="focus1()" onKeyUp="executeClick()"/> )  
            </label>
          </td>
          <td>=</td>
          <td><input type="text" class="textarea2" value="0.9500"  size=5 id="c"></td>
        </tr>
        <tr>
          <td></td>
          <td>
            <label>
            <input type="radio" name = "type1" value="2"> 
            P( &chi;<sup>2</sup> &nbsp; &le; &nbsp; 
            <input type="text" class="textarea" value="3.940" size=6 id="b2" onfocus="focus2()" onKeyUp="executeClick()" /> )
            </label>
          </td>
          <td>=</td>
          <td><input type="text" class="textarea2" value="0.0500"  size=5 id="c2"></td>
          <td>
            <button type="button" id="percentileTable">
              <span data-msgid="Percentile">Percentile</span>
            </button> 
          </td>
       </tr>
        <tr>
          <td></td>
          <td>
            <label>
            <input type="radio" name = "type1" value="3"> 
              P( &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &chi;<sup>2</sup> &nbsp; &ge; &nbsp; 
            <input type="text" class="textarea" value="18.307" size=6 id="a3" onfocus="focus3()" onKeyUp="executeClick()" /> )
            </label>
          </td>
          <td>=</td>
          <td><input type="text" class="textarea2" value="0.0500"  size=5 id="c3"></td>
        </tr>
        <tr>
          <td><span data-msgid="PercentileValue">Percentile</span></td>
          <td>
            <label>
              <input type="radio" name = "type1" value="4" >   
              P( <input type="text" class="textarea2" value="3.247" size=6 id="f"> &nbsp;  &le; &nbsp; &chi;<sup>2</sup> &nbsp; &le; &nbsp; 
              <input type="text" class="textarea2"  value="20.483"  size=6 id="g"> )  
            </label>
          </td>
          <td>=</td>
          <td>
            <input type="text" class="textarea" value="0.9500" size=5 id="h" onfocus="focus4()" onKeyUp="executeClick()" /> 
          </td>
          <td>
<!--
              <sup><small>0 </small></sup>
              <input type="range" min="1" max="999" value="950" id="range4C" onchange="showValueChisq4(this.value)"/>
              <sup><small>1</small> </sup>
-->
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <label> 
              <input type="radio" name = "type1" value="5" > 
              P( &chi;<sup>2</sup> &nbsp; &le; &nbsp;
              <input type="text" class="textarea2" value="3.940" size=6  id="d"> ) 
            </label>
          </td>
          <td>=</td>
          <td>
            <input type="text" class="textarea" value="0.0500" size=5 id="e" onfocus="focus5()" onKeyUp="executeClick()" /> 
          </td>
          <td>
<!--
            <sup><small>0 </small></sup>
            <input type="range" min="1" max="999" value="950" id="range3C" onchange="showValueChisq3(this.value)"/>
            <sup><small>1</small> </sup> 
-->
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <label> 
              <input type="radio" name = "type1" value="6" >
              P( &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &chi;<sup>2</sup> &nbsp; &ge; &nbsp; 
              <input type="text" class="textarea2" value="18.307" size=6  id="a6"/> ) 
            </label>
          </td>
          <td>=</td>
          <td>
            <input type="text" class="textarea" value="0.0500" size=5 id="c6" onfocus="focus6()" onKeyUp="executeClick()" /> 
          </td>
          <td></td>
        </tr>
        <tr>
          <td>
            <button type="button" id="saveGraphU"> 
              <span class="tooltiptext" data-msgid="Graph Save">Graph Save</span>
            </button>
          </td>
          <td></td>
          <td></td>
          <td></td>
          <td>
            <button type="button" id="saveTable">
              <span class="tooltiptext" data-msgid="Table Save">Table Save</span>
            </button>
          </td>
        </tr>
      </tbody>
      </table>
      <p>
      &nbsp;
      <span data-msgid="Reference Site">Reference Site</span> :  &nbsp; 
      <a href="https://en.wikipedia.org/wiki/Chi-squared_distribution" target="_blank" >Wikipedia </a> &nbsp; 
      <a href="http://mathworld.wolfram.com/Chi-SquaredDistribution.html" target="_blank" >Wolfram </a> &nbsp; 
      <a href="http://stattrek.com/probability-distributions/chi-square.aspx" target="_blank" >StatTrek </a> &nbsp; 
      <p>
    </form>
    <div>
      <div id="screenTable">
        <div id="loc">
        </div>
      </div>
    </div>
  </div> 

  <script>
      var bar = d3.select("#chart");

      var svgWidth, svgHeight, margin, graphWidth, graphHeight;
      var svgWidth2, svgHeight2, graphWidth2, graphHeight2;
      svgWidth    = 600;
      svgHeight   = 510;
      svgWidth2   = 600;
      svgHeight2  = 400;
      margin  = {top: 50, bottom: 50, left: 50, right: 40};
      graphWidth2   = svgWidth2 - margin.left - margin.right;
      graphHeight2  = svgHeight2 - margin.top - margin.bottom;

      var nobs, avg, std, gxmin, gxmax, gxrange, gymin, gymax, gyrange;
      var stat = new Array(30);
      var title;
      var df, info;
      var a, b, c, b2, c2, a3, c3, f, g, h, d, e, a6, c6;
      var checkParameter = false;
      var checkExecute = false

      document.getElementById("c").disabled  = true; 
      document.getElementById("c2").disabled = true; 
      document.getElementById("c3").disabled = true; 
      document.getElementById("f").disabled  = true; 
      document.getElementById("g").disabled  = true; 
      document.getElementById("d").disabled  = true; 
      document.getElementById("a6").disabled = true; 

      // 초기 Chisq분포 확률 그리기
      df    = 10;
      a     = 3.247;
      b     = 20.483;
      c     = chisq_cdf(b,df,info) - chisq_cdf(a,df,info);
      gxmax = 30;
      drawChisqGraph(df, a, b, c);

      // Chisq분포 확률 ------------------------------------------------------------------------------------
      var rad = document.myForm.type1;
      var radioType = 1;
      rad[0].onclick = function() {     // P(a< ChiSq < b) = c
          radioType = 1;  
          bar.selectAll("*").remove();
          df    = parseFloat(d3.select("#dfchi").node().value); 
          a = parseFloat(d3.select("#a").node().value); 
          if ( a < 0 ) a = 0.0001;   
          b = parseFloat(d3.select("#b").node().value);
          if ( b > gxmax ) b = gxmax;
          if ( a > b ) c = 0;
          else c = chisq_cdf(b, df, info) - chisq_cdf(a, df, info);
          d3.select("#a").node().value = f3(a)
          d3.select("#b").node().value = f3(b)
          d3.select("#c").node().value = f4(c);
          document.getElementById("range21Chi").value = (300*a/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*b/gxmax - 5).toString();
          drawChisqGraph(df, a, b, c);
      }
      rad[1].onclick = function() {     // P(a< ChiSq < b) = c
          radioType = 2;  
          bar.selectAll("*").remove();
          df    = parseFloat(d3.select("#dfchi").node().value); 
          a = 0.0001;   
          c = parseFloat(d3.select("#c2").node().value); 
          b = chisq_inv(c, df, info);
//          b = parseFloat(d3.select("#b2").node().value);
//          if ( a > b ) c = 0;
//          else c = chisq_cdf(b, df, info);
          if ( b > gxmax ) b = gxmax;
          d3.select("#b2").node().value = f3(b)
          d3.select("#c2").node().value = f4(c);
          document.getElementById("range21Chi").value = (300*a/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*b/gxmax - 5).toString();
          drawChisqGraph(df, a, b, c);
      }
      rad[2].onclick = function() {     // P(a< ChiSq < b) = c
          radioType = 3;  
          bar.selectAll("*").remove();
          df    = parseFloat(d3.select("#dfchi").node().value); 
          c = parseFloat(d3.select("#c3").node().value); 
          a = chisq_inv(1-c, df, info);
          b = gxmax
//          a = parseFloat(d3.select("#a3").node().value); 
          if ( a < 0 ) a = 0.0001;   
          if ( a > b ) c = 0;
          else c = 1 - chisq_cdf(a, df, info);
          d3.select("#a3").node().value = f3(a)
          d3.select("#c3").node().value = f4(c);
          document.getElementById("range21Chi").value = (300*a/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*b/gxmax - 5).toString();
          drawChisqGraph(df, a, b, c);
      }
      rad[3].onclick = function() {     // P(f < ChiSq < g) = h
          radioType = 4;
          bar.selectAll("*").remove();
          df    = parseFloat(d3.select("#dfchi").node().value); 
          h = parseFloat(d3.select("#h").node().value); 
          if (h > 0.9999) h = 0.9999;
          if (h < 0.0001) h = 0.0001;
          f = chisq_inv((1-h)/2, df, info);
          g = chisq_inv(1-(1-h)/2, df, info);
          d3.select("#f").node().value = f3(f);
          d3.select("#g").node().value = f3(g);
          d3.select("#h").node().value = f4(h);
          document.getElementById("range21Chi").value = (300*f/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*g/gxmax - 5).toString();
          drawChisqGraph(df, f, g, h); 
      }    
      rad[4].onclick = function() {     // P(ChiSq < d) = e
          radioType = 5;
          bar.selectAll("*").remove();
          df    = parseFloat(d3.select("#dfchi").node().value); 
          e = parseFloat(d3.select("#e").node().value); 
          if (e > 0.9999) e = 0.9999;
          if (e < 0.0001) e = 0.0001;
          d = chisq_inv(e, df, info);
          d3.select("#d").node().value = f3(d);
          d3.select("#e").node().value = f4(e);
          a = 0;
          document.getElementById("range21Chi").value = (300*a/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*d/gxmax - 5).toString();
          drawChisqGraph(df, a, d, e);
      }
      rad[5].onclick = function() {     // P( Z > b) = c
          radioType = 6;  
          bar.selectAll("*").remove();
          h = parseFloat(d3.select("#c6").node().value); 
          if (h > 0.9999) h = 0.9999;
          if (h < 0.0001) h = 0.0001;
          f = chisq_inv(1-h, df, info);
          g = gxmax;
          d3.select("#a6").node().value = f3(f);
          d3.select("#c6").node().value = f4(h);
          document.getElementById("range21Chi").value = (300*f/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*g/gxmax - 5).toString();
          drawChisqGraph(df, f, g, h); 
      }

      // 확률계산 실행버튼 클릭
      d3.select("#Execute").on("click",function() {
        checkExecute = true;
        if (checkParameter == true) changeRangeCdf(); 
        bar.selectAll("*").remove();
        df    = parseFloat(d3.select("#dfchi").node().value); 
        a  = document.getElementById("a").value; 
        b  = document.getElementById("b").value;
        b2 = document.getElementById("b2").value;
        a3 = document.getElementById("a3").value; 
        e  = document.getElementById("e").value; 
        h  = document.getElementById("h").value;
        if (isNaN(a) || isNaN(b) || isNaN(b2) || isNaN(a3)) {
          alert("Enter number!");
          showValueChisq0(df)
          return;
        }
        if (isNaN(e) || isNaN(h)) {
          alert("Enter number between 0 and 1!");
          showValueChisq0(df)
          return;
        }

        if (radioType == 1) {
          bar.selectAll("text.mean").remove();
          bar.selectAll("line.lineb").remove();
          a = parseFloat(d3.select("#a").node().value); 
          if ( a < 0 ) a = 0.0001;   
          b = parseFloat(d3.select("#b").node().value);
          if ( b > gxmax ) b = gxmax;
          if ( a > b ) c = 0;
          else c = chisq_cdf(b, df, info) - chisq_cdf(a, df, info);
          d3.select("#a").node().value = f3(a)
          d3.select("#b").node().value = f3(b)
          d3.select("#c").node().value = f4(c);
          document.getElementById("range21Chi").value = (300*a/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*b/gxmax - 5).toString();
          drawChisqGraph(df, a, b, c);
        } 
        else if (radioType == 2) {
          bar.selectAll("text.mean").remove();
          bar.selectAll("line.lineb").remove();
          a = 0.0001;   
          b = parseFloat(d3.select("#b2").node().value);
          if ( a > b ) c = 0;
          else c = chisq_cdf(b, df, info);
          d3.select("#b2").node().value = f3(b)
          d3.select("#c2").node().value = f4(c);
          if ( b > gxmax ) b = gxmax;
          document.getElementById("range21Chi").value = (300*a/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*b/gxmax - 5).toString();
          drawChisqGraph(df, a, b, c);
        } 
        else if (radioType == 3) {
          bar.selectAll("text.mean").remove();
          bar.selectAll("line.lineb").remove();
          a = parseFloat(d3.select("#a3").node().value); 
          b = gxmax;
          if ( a < 0 ) a = 0.0001;   
          if ( a > b ) c = 0;
          else c = 1 - chisq_cdf(a, df, info);
          d3.select("#a3").node().value = f3(a)
          d3.select("#c3").node().value = f4(c);
          document.getElementById("range21Chi").value = (300*a/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*b/gxmax - 5).toString();
          drawChisqGraph(df, a, b, c);
        } 
       else if (radioType == 4) {
          bar.selectAll("text.mean").remove();
          bar.selectAll("line.lineb").remove();
          h = parseFloat(d3.select("#h").node().value); 
          if (h > 0.9999) h = 0.9999;
          if (h < 0.0001) h = 0.0001;
          d3.select("#h").node().value = f4(h);
//          document.getElementById("range4C").value  = f0(h*1000);
          g = chisq_inv(1-(1-h)/2, df, info);
          f = chisq_inv((1-h)/2, df, info);
          d3.select("#f").node().value = f3(f);
          d3.select("#g").node().value = f3(g);
          d3.select("#h").node().value = f4(h);
          document.getElementById("range21Chi").value = (300*f/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*g/gxmax - 5).toString();
          drawChisqGraph(df, f, g, h); 
       }
        else if (radioType == 5) {
          bar.selectAll("text.mean").remove();
          bar.selectAll("line.lineb").remove();
          e = parseFloat(d3.select("#e").node().value); 
          if (e > 0.9999) e = 0.9999;
          if (e < 0.0001) e = 0.0001;
//          document.getElementById("range3C").value  = f0(e*1000);
          d = chisq_inv(e, df, info);
          d3.select("#d").node().value = f3(d);
          d3.select("#e").node().value = f4(e);
          a = 0;
          if ( d > gxmax ) d = gxmax;
          document.getElementById("range21Chi").value = (300*a/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*d/gxmax - 5).toString();
          drawChisqGraph(df, a, d, e);
       }
       else if (radioType == 6) {
          bar.selectAll("text.mean").remove();
          bar.selectAll("line.lineb").remove();
          h = parseFloat(d3.select("#c6").node().value); 
          if (h > 0.9999) h = 0.9999;
          if (h < 0.0001) h = 0.0001;
          f = chisq_inv(1-h, df, info);
          g = gxmax;
          d3.select("#a6").node().value = f3(f);
          d3.select("#c6").node().value = f4(h);
          document.getElementById("range21Chi").value = (300*f/gxmax - 5).toString();
          document.getElementById("range22Chi").value = (300*g/gxmax - 5).toString();
          d3.select("#f").node().value = f3(f);
          d3.select("#g").node().value = f3(g);
          drawChisqGraph(df, f, g, h); 
       }
      })

      // svg Graph Save
      d3.select("#saveGraphU").on("click", function() {
        var svg = d3.select("#chart");
        var width = svgWidth;
        var height = svgHeight;
        var svgString = getSVGString(svg.node());
        svgString2Image(svgString, width, height, 'png', save);
        function save(dataBlob, filesize) {
          saveAs(dataBlob, 'eStatGraphU.png');
        }
      });
      // 백분위수표 버튼 클릭
      d3.select("#percentileTable").on("click",function() {
         df    = parseFloat(d3.select("#dfchi").node().value); 
         chisqPercentileTable(df);
      })
      // save Table
      d3.select("#saveTable").on("click", function() {
        head = '<html><head><meta charset="UTF-8"></head><body>';
        tail = '</body></html>';
        saveAs(new Blob([head + d3.select("#screenTable").html() + tail]), "eStatULog.html");
      });

    function changeRangeCdf(){
       if (checkExecute == false && event.keyCode != 13) return;
       df = document.getElementById("dfchi").value;
       if (isNaN(df)) {
          alert("Enter number between 1 and 100!");
          return;
       }
       if (df < 1) { df = 1; document.getElementById("dfchi").value = df;}
       if (df > 100) {df = 100; document.getElementById("dfchi").value = df;}
       document.getElementById("range1C").value = df;
       showValueChisq0(df)
       checkExecute   = false;
    }
  </script>
</body>
</html>
