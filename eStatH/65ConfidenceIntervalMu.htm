<!DOCTYPE html>
<html>

<head>
    <title data-msgid="Confidence Interval">Confidence Interval</title>
    <link rel="stylesheet" href="/estat/eStat/css/eStatU.css">
    <script src="/estat/eStat/lib/d3/d3.v4.min.js"></script>
    <script src="/estat/eStat/lib/jquery/jquery-3.2.1.min.js"></script>
    <script src="/estat/eStat/lib/jquery/jquery-ui.min.js"></script>
    <script src="/estat/eStat/lib/DistributionsUtil.js" ></script>
    <script src="/estat/eStat/js/language.js" ></script>
    <script src="/estat/eStat/js/eStatU.js"></script>
    <script src="/estat/eStat/lib/FileSaver.min.js" ></script>
    <script src="/estat/eStat/lib/convertSVG.js"></script>
</head>

<body>
  <div width="600" height="410" style="position:absolute; left:10px; top:0px">
    <br>
    <div class="title">
      <b>&nbsp; <span data-msgid="Confidence Interval">Confidence Interval </span> </b>
      <a class="menu" href="index.html"><b><span data-msgid="Menu">Menu</span></b></a>  
    </div>
    <br>
    <b>[<span data-msgid="Sample Data">Sample Data</span>]</b>&nbsp; 
    <span class="fontguide" data-msgid="input either sample data">
      (input either sample data or sample statistics using csv / bsv)
    </span>   
    <p>
    <table class="data">
      <tbody>
	<tr>
          <td> &nbsp; &nbsp;</td>
	  <td><input type="text" size=60 id="data1"></td>
	</tr>
      </tbody>
    </table>
    <p>
    <b>[<span data-msgid="Sample Statistics">Sample Statistics</span>]</b>   
    <table class="stat">
      <tbody>
	<tr>
          <td></td>
	  <td><span data-msgid="Sample Size">Sample Size</span></td>
	  <td><span class="fontmath">n</span></td>
	  <td>=</td>
	  <td><input type="text" class="textarea" size=6 id="nn"></td>
          <td> <span class="fontguide">(>1) </span></td>
	</tr>
	<tr>
          <td></td>
	  <td><span data-msgid="Sample Mean">Sample Mean</span></td>
	  <td><span class="fontmath">m</span></td>
	  <td>=</td>
	  <td><input type="text" class="textarea" size=6 id="xbar"></td>
	</tr>
	<tr>
          <td></td>
	  <td><span data-msgid="Sample Variance">Sample Variance</span></td>
	  <td><span class="fontmath">s<sup>2</sup></span></td>
	  <td>=</td>
	  <td><input type="text" class="textarea" size=6 id="std"></td>
          <td>(<span class="fontguide" data-msgid="n_variance">(n formula)</span>) </td>
          <td>
            <button type="button" id="executeTH"> 
               <span data-msgid="Confidence Interval">Confidence Interval</span>
               <span data-msgid="Execute">Execute</span>
            </button> 
          </td>
	</tr>
      </tbody>
    </table>
    <p>
    <form name="myForm2">
      <b>[<span data-msgid="Confidence Level">Confidence Level</span>]</b> &nbsp; 
      <input type="radio" name = "type2" value="1" checked> 95%       
      <input type="radio" name = "type2" value="2" > 99%
    </form>       

    <p>
    <b>[<span data-msgid="Confidence Interval">Confidence Interval</span>]</b>
    <table class="stat">
      <tbody>
	<tr>
          <td></td>
	  <td><span class="fontmath">Z =</span></td>
	  <td><input type="text" class="textarea" size=4 id="zvalue"></td>
          <td></td>
	  <td><span class="fontmath">s =</span></td>
	  <td><input type="text" class="textarea" size=4 id="svalue"></td>
          <td></td>
          <td><span class="fontmath"> (s / &radic; n ) =</span></td>
	  <td><input type="text" class="textarea" size=4 id="stderr"></td>
	</tr>
      </tbody>
    </table>
    <p>
    <table class="stat">
      <tbody>
	<tr>
          <td></td>
	  <td><span class="fontmath">m</span></td>
	  <td>&plusmn;</td>
	  <td><span class="fontmath">Z</span></td>
          <td><span class="fontmath"> (s / &radic; n )</span></td>
          <td>&hArr;</td>
	  <td>(&nbsp;<input type="text" class="textarea" size=6 id="cleft">&nbsp;&nbsp;&nbsp;,</td>
	  <td><input type="text" class="textarea" size=6 id="cright">&nbsp;)</td>
	</tr>
      </tbody>
    </table>

  </div> 

  <script>
      var alpha, zvalue, svalue, stderr, info;
      var nn, xbar, vari, std, left, right, temp;
      document.getElementById("executeTH").style.backgroundColor = "yellowgreen";
      document.getElementById("zvalue").style.backgroundColor = "#eee";
      document.getElementById("svalue").style.backgroundColor = "#eee";
      document.getElementById("stderr").style.backgroundColor = "#eee";
      document.getElementById("cleft").style.backgroundColor = "#eee";
      document.getElementById("cright").style.backgroundColor = "#eee"; 
      document.getElementById("zvalue").disabled = true;
      document.getElementById("svalue").disabled = true;
      document.getElementById("stderr").disabled = true;
      document.getElementById("cleft").disabled  = true;
      document.getElementById("cright").disabled = true;
      // alpha
      if (document.myForm2.type2.value == "1") alpha = 0.05;
      else alpha = 0.01
      zvalue = stdnormal_inv(1 - alpha/2, info);
      var a = document.myForm2.type2;
      a[0].onclick = function() { 
        alpha = 0.05; 
        zvalue = stdnormal_inv(1 - alpha/2, info);
        document.getElementById("executeTH").click();
      }  
      a[1].onclick = function() { 
        alpha = 0.01; 
        zvalue = stdnormal_inv(1 - alpha/2, info);
        document.getElementById("executeTH").click();
      }  

      // data input control =====================================
      d3.select("#data1").on("input", function() {
        stat = simplestat("#data1");  
        if (stat.n == 0) { updateData(); updateStat();}
        else {
          document.getElementById("nn").value   = stat.n;    
          document.getElementById("xbar").value = f4(stat.xbar);
          document.getElementById("std").value  = f4(stat.var);  
          svalue = Math.sqrt(stat.var);
          stderr = svalue / Math.sqrt(stat.n);
          temp   = zvalue * stderr;
          left  = stat.xbar - temp;
          right = stat.xbar + temp;  
          document.getElementById("zvalue").value  = f4(zvalue);
          document.getElementById("svalue").value  = f4(svalue); 
          document.getElementById("stderr").value  = f4(stderr);
          document.getElementById("cleft").value   = f4(left);
          document.getElementById("cright").value  = f4(right); 
        }
      });

      updateData = function() {
        document.getElementById("data1").value  = ''; 
        document.getElementById("zvalue").value = ''; 
        document.getElementById("svalue").value = ''; 
        document.getElementById("stderr").value = ''; 
        document.getElementById("cleft").value  = ''; 
        document.getElementById("cright").value = ''; 
      }
      updateStat = function() {
        document.getElementById("nn").value   = "";    
        document.getElementById("xbar").value = "";    
        document.getElementById("std").value  = "";      
      }

      d3.select("#nn").on("input", updateData);
      d3.select("#xbar").on("input", updateData);
      d3.select("#std").on("input", updateData);

      // Confidence Interval Calculation ======================================
      d3.select("#executeTH").on("click",function() {
        // input value
        nn   = parseInt(d3.select("#nn").node().value);
        document.getElementById("nn").value   = nn;
        xbar = parseFloat(d3.select("#xbar").node().value);
        vari  = Math.sqrt(parseFloat(d3.select("#std").node().value));
        // confidence interval
        svalue = Math.sqrt(vari);
        stderr = svalue / Math.sqrt(nn);
        temp   = zvalue * stderr;
        left   = xbar - temp;
        right  = xbar + temp;  
        document.getElementById("zvalue").value  = f4(zvalue);
        document.getElementById("svalue").value  = f4(svalue); 
        document.getElementById("stderr").value  = f4(stderr);
        document.getElementById("cleft").value   = f4(left);
        document.getElementById("cright").value  = f4(right); 

      })

  </script>
</body>
</html>
